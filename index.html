<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Pearl Cannon Calculator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1e1e1e;
            color: #e0e0e0;
        }
        .container {
            display: grid;
            grid-template-columns: 300px 1fr;
            grid-template-rows: auto 1fr;
            gap: 20px;
            grid-template-areas:
                "converter title"
                "converter calculator";
        }
        .title-area {
            grid-area: title;
            text-align: center;
        }
        .converter {
            grid-area: converter;
            background-color: #252526;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            height: fit-content;
        }
        .main-calculator {
            grid-area: calculator;
            background-color: #252526;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        h1 {
            color: #4fc3f7;
            margin-bottom: 20px;
        }
        h2 {
            margin-top: 0;
            color: #4fc3f7;
            font-size: 1.2em;
            border-bottom: 1px solid #444;
            padding-bottom: 8px;
        }
        h3 {
            color: #4fc3f7;
            font-size: 1em;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .coordinate-section {
            background-color: #333333;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4fc3f7;
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #b3e5fc;
        }
        input, select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #555;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #3c3c3c;
            color: #e0e0e0;
        }
        button {
            background-color: #4fc3f7;
            color: #1e1e1e;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: block;
            margin: 15px auto;
            width: 200px;
            font-weight: bold;
        }
        button:hover {
            background-color: #29b6f6;
        }
        button:disabled {
            background-color: #555;
            color: #999;
            cursor: not-allowed;
        }
        .results {
            background-color: #2d3748;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #4ade80;
        }
        .results h3 {
            color: #4ade80;
            margin-top: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #444;
        }
        th {
            background-color: #333;
            color: #b3e5fc;
        }
        .relative-coords {
            font-weight: bold;
            color: #4fc3f7;
        }
        .minecraft-font {
            font-weight: bold;
            letter-spacing: 1px;
        }
        .hidden {
            display: none;
        }
        .error {
            color: #ff6b6b;
            font-weight: bold;
        }
        .success {
            color: #4ade80;
            font-weight: bold;
        }
        .warning {
            color: #ffa726;
            font-weight: bold;
        }
        .interpolated {
            color: #ffa726;
            font-style: italic;
        }
        .exact {
            color: #4ade80;
            font-weight: bold;
        }
        .distance-info {
            background-color: #3a3a3a;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-areas:
                    "title"
                    "converter"
                    "calculator";
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title-area">
            <h1 class="minecraft-font">Minecraft Pearl Cannon Calculator</h1>
        </div>
        
        <div class="converter">
            <h2>Coordinate Converter</h2>
            <div class="coordinate-section">
                <label for="conv-machine-x">Machine X:</label>
                <input type="number" id="conv-machine-x" placeholder="Enter X coordinate" value="1001">
                
                <label for="conv-machine-z">Machine Z:</label>
                <input type="number" id="conv-machine-z" placeholder="Enter Z coordinate" value="1026">
            </div>
            
            <div class="coordinate-section">
                <label for="conv-target-x">Target X:</label>
                <input type="number" id="conv-target-x" placeholder="Enter X coordinate">
                
                <label for="conv-target-z">Target Z:</label>
                <input type="number" id="conv-target-z" placeholder="Enter Z coordinate">
            </div>
            
            <button onclick="convertCoordinates()">Convert</button>
            
            <div id="converter-results" class="results hidden">
                <h3>Converted Coordinates</h3>
                
                <table>
                    <tr>
                        <th>Point</th>
                        <th>Relative Position</th>
                    </tr>
                    <tr>
                        <td>Machine:</td>
                        <td class="relative-coords">
                            (0, 0)
                        </td>
                    </tr>
                    <tr>
                        <td>Target:</td>
                        <td class="relative-coords">
                            X: <span id="rel-target-x"></span>, 
                            Z: <span id="rel-target-z"></span>
                        </td>
                    </tr>
                    <tr>
                        <td>Distance:</td>
                        <td><span id="conv-distance"></span> blocks</td>
                    </tr>
                </table>
            </div>
        </div>
        
        <div class="main-calculator">
            <h2>Pearl Cannon Setup Calculator</h2>
            
            <div class="coordinate-section">
                <h3>Cannon Configuration</h3>
                <label for="machine-x">Machine X Coordinate:</label>
                <input type="number" id="machine-x" value="1001" placeholder="Enter machine X">
                
                <label for="machine-z">Machine Z Coordinate:</label>
                <input type="number" id="machine-z" value="1026" placeholder="Enter machine Z">
                
                <label for="calculation-mode">Calculation Mode:</label>
                <select id="calculation-mode">
                    <option value="target">Target Coordinates</option>
                    <option value="distance">Distance from Machine</option>
                </select>
            </div>
            
            <div id="target-mode" class="coordinate-section">
                <h3>Target Information</h3>
                <label for="target-x">Target X Coordinate:</label>
                <input type="number" id="target-x" placeholder="Enter target X">
                
                <label for="target-z">Target Z Coordinate:</label>
                <input type="number" id="target-z" placeholder="Enter target Z">
            </div>
            
            <div id="distance-mode" class="coordinate-section hidden">
                <h3>Distance Information</h3>
                <label for="target-distance">Distance from Machine:</label>
                <input type="number" id="target-distance" placeholder="Enter distance in blocks">
                
                <label for="target-angle">Angle (degrees from +X axis):</label>
                <input type="number" id="target-angle" placeholder="Enter angle (0-360)" min="0" max="360">
            </div>
            
            <button onclick="calculateCharges()">Calculate Required Charges</button>
            
            <div id="calculation-results" class="results hidden">
                <h3>Calculation Results</h3>
                <div id="results-content"></div>
            </div>
        </div>
    </div>

    <script>
        // Pearl cannon trajectory data (charges 1-32 with landing coordinates)
        const trajectoryData = [
            {charge: 1, x: 967.63, z: 1059.38},
            {charge: 2, x: 929.48, z: 1097.51},
            {charge: 3, x: 886.13, z: 1140.87},
            {charge: 4, x: 837.12, z: 1189.89},
            {charge: 5, x: 782.05, z: 1244.95},
            {charge: 6, x: 720.51, z: 1306.49},
            {charge: 7, x: 652.20, z: 1374.79},
            {charge: 8, x: 576.79, z: 1450.21},
            {charge: 9, x: 494.01, z: 1533.00},
            {charge: 10, x: 403.62, z: 1623.37},
            {charge: 11, x: 305.43, z: 1721.57},
            {charge: 12, x: 199.28, z: 1827.74},
            {charge: 13, x: 85.00, z: 1941.99},
            {charge: 14, x: -37.52, z: 2064.52},
            {charge: 15, x: -168.37, z: 2195.35},
            {charge: 16, x: -307.65, z: 2334.65},
            {charge: 17, x: -455.44, z: 2482.45},
            {charge: 18, x: -611.79, z: 2638.79},
            {charge: 19, x: -776.74, z: 2803.76},
            {charge: 20, x: -950.35, z: 2977.35},
            {charge: 21, x: -1132.66, z: 3159.65},
            {charge: 22, x: -1323.69, z: 3350.69},
            {charge: 23, x: -1523.46, z: 3550.48},
            {charge: 24, x: -1731.99, z: 3759.02},
            {charge: 25, x: -1949.34, z: 3976.30},
            {charge: 26, x: -2175.46, z: 4202.44},
            {charge: 27, x: -2410.41, z: 4437.42},
            {charge: 28, x: -2654.21, z: 4681.20},
            {charge: 29, x: -2906.83, z: 4933.82},
            {charge: 30, x: -3168.28, z: 5195.25},
            {charge: 31, x: -3438.62, z: 5465.61},
            {charge: 32, x: -3717.81, z: 5744.81}
        ];

        // Machine position
        const machinePos = {x: 1001.0, z: 1026.0};

        // Convert trajectory data to relative coordinates and distances
        const relativeTrajectory = trajectoryData.map(point => {
            const relX = point.x - machinePos.x;
            const relZ = point.z - machinePos.z;
            const distance = Math.sqrt(relX * relX + relZ * relZ);
            return {
                charge: point.charge,
                relX: relX,
                relZ: relZ,
                distance: distance,
                absX: point.x,
                absZ: point.z
            };
        });

        function convertCoordinates() {
            const machineX = parseFloat(document.getElementById('conv-machine-x').value) || 0;
            const machineZ = parseFloat(document.getElementById('conv-machine-z').value) || 0;
            
            const targetX = parseFloat(document.getElementById('conv-target-x').value) || 0;
            const targetZ = parseFloat(document.getElementById('conv-target-z').value) || 0;
            
            const relX = targetX - machineX;
            const relZ = targetZ - machineZ;
            const distance = Math.sqrt(relX * relX + relZ * relZ);
            
            document.getElementById('rel-target-x').textContent = relX.toFixed(2);
            document.getElementById('rel-target-z').textContent = relZ.toFixed(2);
            document.getElementById('conv-distance').textContent = distance.toFixed(2);
            
            document.getElementById('converter-results').classList.remove('hidden');
        }

        function toggleCalculationMode() {
            const mode = document.getElementById('calculation-mode').value;
            const targetMode = document.getElementById('target-mode');
            const distanceMode = document.getElementById('distance-mode');
            
            if (mode === 'target') {
                targetMode.classList.remove('hidden');
                distanceMode.classList.add('hidden');
            } else {
                targetMode.classList.add('hidden');
                distanceMode.classList.remove('hidden');
            }
        }

        function findBestCharges(targetX, targetZ, machineX, machineZ) {
            const relTargetX = targetX - machineX;
            const relTargetZ = targetZ - machineZ;
            const targetDistance = Math.sqrt(relTargetX * relTargetX + relTargetZ * relTargetZ);
            
            // Find exact matches and closest options
            let exactMatch = null;
            let closestOptions = [];
            let minDistance = Infinity;
            
            relativeTrajectory.forEach(point => {
                const distance = Math.sqrt(
                    Math.pow(point.relX - relTargetX, 2) + 
                    Math.pow(point.relZ - relTargetZ, 2)
                );
                
                if (distance < 1.0) { // Within 1 block = close enough for exact
                    exactMatch = {
                        ...point,
                        error: distance
                    };
                }
                
                if (distance < minDistance) {
                    minDistance = distance;
                    closestOptions = [{
                        ...point,
                        error: distance
                    }];
                } else if (Math.abs(distance - minDistance) < 0.1) {
                    closestOptions.push({
                        ...point,
                        error: distance
                    });
                }
            });
            
            // Try interpolation between closest charges
            let interpolatedResult = null;
            if (!exactMatch && closestOptions.length > 0) {
                interpolatedResult = attemptInterpolation(relTargetX, relTargetZ);
            }
            
            return {
                exact: exactMatch,
                closest: closestOptions.slice(0, 3), // Top 3 closest
                interpolated: interpolatedResult,
                targetDistance: targetDistance
            };
        }

        function attemptInterpolation(targetX, targetZ) {
            // Find two consecutive charges that bracket the target
            for (let i = 0; i < relativeTrajectory.length - 1; i++) {
                const p1 = relativeTrajectory[i];
                const p2 = relativeTrajectory[i + 1];
                
                // Check if target is roughly between these two points
                const dist1 = Math.sqrt(Math.pow(p1.relX - targetX, 2) + Math.pow(p1.relZ - targetZ, 2));
                const dist2 = Math.sqrt(Math.pow(p2.relX - targetX, 2) + Math.pow(p2.relZ - targetZ, 2));
                
                if (dist1 < 100 && dist2 < 100) { // Both points reasonably close
                    // Linear interpolation
                    const dx = p2.relX - p1.relX;
                    const dz = p2.relZ - p1.relZ;
                    
                    if (dx !== 0 || dz !== 0) {
                        const targetDx = targetX - p1.relX;
                        const targetDz = targetZ - p1.relZ;
                        
                        // Project target onto line between p1 and p2
                        const t = Math.max(0, Math.min(1, 
                            (targetDx * dx + targetDz * dz) / (dx * dx + dz * dz)
                        ));
                        
                        const interpolatedCharge = p1.charge + t * (p2.charge - p1.charge);
                        const interpX = p1.relX + t * dx;
                        const interpZ = p1.relZ + t * dz;
                        
                        const error = Math.sqrt(
                            Math.pow(interpX - targetX, 2) + 
                            Math.pow(interpZ - targetZ, 2)
                        );
                        
                        return {
                            charge: interpolatedCharge,
                            chargeRange: `${p1.charge}-${p2.charge}`,
                            relX: interpX,
                            relZ: interpZ,
                            error: error
                        };
                    }
                }
            }
            return null;
        }

        function calculateCharges() {
            const mode = document.getElementById('calculation-mode').value;
            const machineX = parseFloat(document.getElementById('machine-x').value) || 1001;
            const machineZ = parseFloat(document.getElementById('machine-z').value) || 1026;
            
            let targetX, targetZ;
            
            if (mode === 'target') {
                targetX = parseFloat(document.getElementById('target-x').value);
                targetZ = parseFloat(document.getElementById('target-z').value);
                
                if (isNaN(targetX) || isNaN(targetZ)) {
                    document.getElementById('results-content').innerHTML = 
                        '<p class="error">Please enter valid target coordinates.</p>';
                    document.getElementById('calculation-results').classList.remove('hidden');
                    return;
                }
            } else {
                const distance = parseFloat(document.getElementById('target-distance').value);
                const angle = parseFloat(document.getElementById('target-angle').value);
                
                if (isNaN(distance) || isNaN(angle)) {
                    document.getElementById('results-content').innerHTML = 
                        '<p class="error">Please enter valid distance and angle.</p>';
                    document.getElementById('calculation-results').classList.remove('hidden');
                    return;
                }
                
                // Convert polar to cartesian
                const radians = (angle * Math.PI) / 180;
                targetX = machineX + distance * Math.cos(radians);
                targetZ = machineZ + distance * Math.sin(radians);
            }
            
            const results = findBestCharges(targetX, targetZ, machineX, machineZ);
            displayResults(results, targetX, targetZ, machineX, machineZ);
        }

        function displayResults(results, targetX, targetZ, machineX, machineZ) {
            let html = `
                <div class="distance-info">
                    <strong>Target:</strong> (${targetX.toFixed(2)}, ${targetZ.toFixed(2)})<br>
                    <strong>Machine:</strong> (${machineX.toFixed(2)}, ${machineZ.toFixed(2)})<br>
                    <strong>Distance:</strong> ${results.targetDistance.toFixed(2)} blocks
                </div>
            `;
            
            if (results.exact) {
                html += `
                    <h4 class="exact">🎯 Exact Match Found!</h4>
                    <table>
                        <tr><th>Charges</th><th>Landing Position</th><th>Error</th></tr>
                        <tr>
                            <td class="exact">${results.exact.charge}</td>
                            <td>(${(machineX + results.exact.relX).toFixed(2)}, ${(machineZ + results.exact.relZ).toFixed(2)})</td>
                            <td class="exact">${results.exact.error.toFixed(2)} blocks</td>
                        </tr>
                    </table>
                `;
            }
            
            if (results.interpolated && (!results.exact || results.interpolated.error < results.exact.error)) {
                html += `
                    <h4 class="interpolated">📊 Interpolated Solution</h4>
                    <p class="interpolated">Estimated charges between ${results.interpolated.chargeRange}</p>
                    <table>
                        <tr><th>Estimated Charges</th><th>Predicted Position</th><th>Error</th></tr>
                        <tr>
                            <td class="interpolated">${results.interpolated.charge.toFixed(2)}</td>
                            <td>(${(machineX + results.interpolated.relX).toFixed(2)}, ${(machineZ + results.interpolated.relZ).toFixed(2)})</td>
                            <td class="interpolated">${results.interpolated.error.toFixed(2)} blocks</td>
                        </tr>
                    </table>
                    <p class="warning">⚠️ Interpolated values are estimates. Test with nearby whole number charges.</p>
                `;
            }
            
            if (results.closest.length > 0) {
                html += `
                    <h4>🔍 Closest Options</h4>
                    <table>
                        <tr><th>Charges</th><th>Landing Position</th><th>Error</th></tr>
                `;
                
                results.closest.forEach(option => {
                    html += `
                        <tr>
                            <td>${option.charge}</td>
                            <td>(${(machineX + option.relX).toFixed(2)}, ${(machineZ + option.relZ).toFixed(2)})</td>
                            <td>${option.error.toFixed(2)} blocks</td>
                        </tr>
                    `;
                });
                
                html += '</table>';
            }
            
            document.getElementById('results-content').innerHTML = html;
            document.getElementById('calculation-results').classList.remove('hidden');
        }

        // Event listeners
        document.getElementById('calculation-mode').addEventListener('change', toggleCalculationMode);
        
        // Initialize
        toggleCalculationMode();
    </script>
</body>
</html>
