<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ender Pearl Cannon Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 600px;
            margin: 40px auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background-color: #6b7280;
            color: white;
            padding: 24px;
            text-align: center;
        }
        h1 {
            font-size: 24px;
            font-weight: 600;
        }
        .content {
            padding: 32px;
        }
        .input-section {
            margin-bottom: 32px;
        }
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #4b5563;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }
        .input-group {
            display: flex;
            flex-direction: column;
        }
        label {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 4px;
            font-weight: 500;
        }
        input[type="number"] {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            background: #f9fafb;
            font-size: 16px;
            transition: all 0.2s;
        }
        input[type="number"]:focus {
            outline: none;
            border-color: #6b7280;
            background: white;
        }
        .calculate-btn {
            width: 100%;
            padding: 16px;
            background-color: #6b7280;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .calculate-btn:hover {
            background-color: #4b5563;
        }
        .results {
            margin-top: 32px;
            background-color: #f9fafb;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }
        .results-header {
            background-color: #6b7280;
            color: white;
            padding: 16px;
            font-weight: 600;
            text-align: center;
        }
        .result-grid {
            padding: 24px;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .result-item:last-child {
            border-bottom: none;
            padding-top: 16px;
            margin-top: 8px;
            border-top: 2px solid #e5e7eb;
        }
        .machine-name {
            font-weight: 600;
            color: #4b5563;
        }
        .charges-badge {
            background-color: #6b7280;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }
        .charges-badge.active {
            background-color: #059669;
        }
        .error {
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            color: #b91c1c;
            padding: 16px;
            border-radius: 6px;
            margin-top: 16px;
            text-align: center;
        }
        .info-box {
            background-color: #f0f9ff;
            border: 1px solid #bae6fd;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 24px;
            font-size: 14px;
            color: #0369a1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ender Pearl Cannon Calculator</h1>
        </div>
        
        <div class="content">
            <div class="info-box">
                <strong>Note:</strong> The charge data is based on the +X machine. Enter machine and target coordinates to calculate required charges for each direction.
            </div>

            <div class="input-section">
                <div class="section-title">Machine Location</div>
                <div class="input-row">
                    <div class="input-group">
                        <label for="machineX">X Coordinate</label>
                        <input type="number" id="machineX" value="1001" step="0.01">
                    </div>
                    <div class="input-group">
                        <label for="machineZ">Z Coordinate</label>
                        <input type="number" id="machineZ" value="1026" step="0.01">
                    </div>
                </div>
            </div>

            <div class="input-section">
                <div class="section-title">Target Location</div>
                <div class="input-row">
                    <div class="input-group">
                        <label for="targetX">X Coordinate</label>
                        <input type="number" id="targetX" step="0.01" placeholder="Enter target X">
                    </div>
                    <div class="input-group">
                        <label for="targetZ">Z Coordinate</label>
                        <input type="number" id="targetZ" step="0.01" placeholder="Enter target Z">
                    </div>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateCharges()">Calculate</button>

            <div id="results" class="results" style="display: none;">
                <div class="results-header">Required Charges</div>
                <div class="result-grid">
                    <div class="result-item">
                        <span class="machine-name">+X Machine (East)</span>
                        <span id="plusX" class="charges-badge">0</span>
                    </div>
                    <div class="result-item">
                        <span class="machine-name">-X Machine (West)</span>
                        <span id="minusX" class="charges-badge">0</span>
                    </div>
                    <div class="result-item">
                        <span class="machine-name">+Z Machine (South)</span>
                        <span id="plusZ" class="charges-badge">0</span>
                    </div>
                    <div class="result-item">
                        <span class="machine-name">-Z Machine (North)</span>
                        <span id="minusZ" class="charges-badge">0</span>
                    </div>
                    <div class="result-item">
                        <span class="machine-name">Total Items Needed</span>
                        <span id="total" class="charges-badge">0</span>
                    </div>
                </div>
                <div id="activeInstructions" style="margin-top: 16px; padding: 16px; background: #f0f9ff; border-radius: 6px; color: #0369a1; font-weight: 600; text-align: center;"></div>
            </div>

            <div id="error" class="error" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Landing positions from +X machine (charges: [deltaX, deltaZ] from machine at 1001, 1026)
        const landingData = {
            0: [967.63 - 1001, 1059.38 - 1026],   // [-33.37, 33.38]
            1: [929.48 - 1001, 1097.51 - 1026],   // [-71.52, 71.51]
            2: [886.13 - 1001, 1140.87 - 1026],   // [-114.87, 114.87]
            3: [837.12 - 1001, 1189.89 - 1026],   // [-163.88, 163.89]
            4: [782.05 - 1001, 1244.95 - 1026],   // [-218.95, 218.95]
            5: [720.51 - 1001, 1306.49 - 1026],   // [-280.49, 280.49]
            6: [652.20 - 1001, 1374.79 - 1026],   // [-348.80, 348.79]
            7: [576.79 - 1001, 1450.21 - 1026],   // [-424.21, 424.21]
            8: [494.01 - 1001, 1533.00 - 1026],   // [-506.99, 507.00]
            9: [403.62 - 1001, 1623.37 - 1026],   // [-597.38, 597.37]
            10: [305.43 - 1001, 1721.57 - 1026],  // [-695.57, 695.57]
            11: [199.28 - 1001, 1827.74 - 1026],  // [-801.72, 801.74]
            12: [85.00 - 1001, 1941.99 - 1026],   // [-916.00, 915.99]
            13: [-37.52 - 1001, 2064.52 - 1026],  // [-1038.52, 1038.52]
            14: [-168.37 - 1001, 2195.35 - 1026], // [-1169.37, 1169.35]
            15: [-307.65 - 1001, 2334.65 - 1026], // [-1308.65, 1308.65]
            16: [-455.44 - 1001, 2482.45 - 1026], // [-1456.44, 1456.45]
            17: [-611.79 - 1001, 2638.79 - 1026], // [-1612.79, 1612.79]
            18: [-776.74 - 1001, 2803.76 - 1026], // [-1777.74, 1777.76]
            19: [-950.35 - 1001, 2977.35 - 1026], // [-1951.35, 1951.35]
            20: [-1132.66 - 1001, 3159.65 - 1026], // [-2133.66, 2133.65]
            21: [-1323.69 - 1001, 3350.69 - 1026], // [-2324.69, 2324.69]
            22: [-1523.46 - 1001, 3550.48 - 1026], // [-2524.46, 2524.48]
            23: [-1731.99 - 1001, 3759.02 - 1026], // [-2732.99, 2733.02]
            24: [-1949.34 - 1001, 3976.30 - 1026], // [-2950.34, 2950.30]
            25: [-2175.46 - 1001, 4202.44 - 1026], // [-3176.46, 3176.44]
            26: [-2410.41 - 1001, 4437.42 - 1026], // [-3411.41, 3411.42]
            27: [-2654.21 - 1001, 4681.20 - 1026], // [-3655.21, 3655.20]
            28: [-2906.83 - 1001, 4933.82 - 1026], // [-3907.83, 3907.82]
            29: [-3168.28 - 1001, 5195.25 - 1026], // [-4169.28, 4169.25]
            30: [-3438.62 - 1001, 5465.61 - 1026], // [-4439.62, 4439.61]
            31: [-3717.81 - 1001, 5744.81 - 1026]  // [-4718.81, 4718.81]
        };

        function interpolateCharges(targetDistance) {
            // Use X-axis distance for interpolation (since data is from +X machine)
            const absDistance = Math.abs(targetDistance);
            
            // Find exact match first
            for (let charges in landingData) {
                if (Math.abs(Math.abs(landingData[charges][0]) - absDistance) < 0.01) {
                    return parseInt(charges);
                }
            }

            // Find bracketing points
            let lower = null, upper = null;
            for (let charges in landingData) {
                const dataDistance = Math.abs(landingData[charges][0]);
                
                if (dataDistance <= absDistance) {
                    if (!lower || dataDistance > Math.abs(landingData[lower][0])) {
                        lower = charges;
                    }
                }
                if (dataDistance >= absDistance) {
                    if (!upper || dataDistance < Math.abs(landingData[upper][0])) {
                        upper = charges;
                    }
                }
            }

            if (!lower && !upper) return 0;
            if (!lower) return parseInt(upper);
            if (!upper) return parseInt(lower);
            if (lower === upper) return parseInt(lower);

            // Linear interpolation
            const lowerDist = Math.abs(landingData[lower][0]);
            const upperDist = Math.abs(landingData[upper][0]);
            const t = (absDistance - lowerDist) / (upperDist - lowerDist);
            const interpolated = parseInt(lower) + t * (parseInt(upper) - parseInt(lower));
            
            return Math.max(0, Math.round(interpolated));
        }

        function calculateCharges() {
            const machineX = parseFloat(document.getElementById('machineX').value);
            const machineZ = parseFloat(document.getElementById('machineZ').value);
            const targetX = parseFloat(document.getElementById('targetX').value);
            const targetZ = parseFloat(document.getElementById('targetZ').value);

            if (isNaN(machineX) || isNaN(machineZ) || isNaN(targetX) || isNaN(targetZ)) {
                showError('Please enter valid coordinates for all fields.');
                return;
            }

            hideError();

            // Calculate required distances
            const deltaX = targetX - machineX;
            const deltaZ = targetZ - machineZ;

            // Calculate charges for each machine
            let plusX = 0, minusX = 0, plusZ = 0, minusZ = 0;
            let activeMachines = [];

            if (deltaX > 0) {
                plusX = interpolateCharges(deltaX);
                if (plusX > 0) activeMachines.push('+X');
            } else if (deltaX < 0) {
                minusX = interpolateCharges(deltaX);
                if (minusX > 0) activeMachines.push('-X');
            }

            if (deltaZ > 0) {
                plusZ = interpolateCharges(deltaZ);
                if (plusZ > 0) activeMachines.push('+Z');
            } else if (deltaZ < 0) {
                minusZ = interpolateCharges(deltaZ);
                if (minusZ > 0) activeMachines.push('-Z');
            }

            // Update display
            updateResultDisplay('plusX', plusX);
            updateResultDisplay('minusX', minusX);
            updateResultDisplay('plusZ', plusZ);
            updateResultDisplay('minusZ', minusZ);
            
            const total = plusX + minusX + plusZ + minusZ;
            document.getElementById('total').textContent = total;
            document.getElementById('total').className = 'charges-badge active';

            // Show active machines instruction
            const instructionEl = document.getElementById('activeInstructions');
            if (activeMachines.length > 0) {
                instructionEl.textContent = `Use machines: ${activeMachines.join(' and ')}`;
            } else {
                instructionEl.textContent = 'Target is at machine location - no charges needed';
            }

            document.getElementById('results').style.display = 'block';
        }

        function updateResultDisplay(elementId, charges) {
            const element = document.getElementById(elementId);
            element.textContent = charges;
            element.className = charges > 0 ? 'charges-badge active' : 'charges-badge';
        }

        function showError(message) {
            document.getElementById('error').textContent = message;
            document.getElementById('error').style.display = 'block';
            document.getElementById('results').style.display = 'none';
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        // Enter key support
        document.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                calculateCharges();
            }
        });
    </script>
</body>
</html>
